<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeSpace Studio - Journal & SolidarityCast</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Enhanced interactive styles */
        :root {
            --primary-color: #6C63FF;
            --primary-light: #8B85FF;
            --primary-dark: #554FD8;
            --secondary-color: #FF6B8B;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --light-color: #F5F5F7;
            --dark-color: #2D2B55;
            --text-color: #333333;
            --text-light: #777777;
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            --box-shadow-lg: 0 16px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s ease;
            --gradient: linear-gradient(135deg, #6C63FF 0%, #8B85FF 100%);
        }

        .dark-mode {
            --light-color: #1E1E2E;
            --dark-color: #F5F5F7;
            --text-color: #F5F5F7;
            --text-light: #AAAAAA;
            --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            --box-shadow-lg: 0 16px 40px rgba(0, 0, 0, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(108, 99, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 107, 139, 0.05) 0%, transparent 20%);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hover-grow {
            transition: transform 0.3s ease;
        }

        .hover-grow:hover {
            transform: scale(1.03);
        }

        .smooth-transition {
            transition: all 0.3s ease;
        }

        .recording-active {
            box-shadow: 0 0 20px rgba(108, 99, 255, 0.6);
        }

        .typing-indicator {
            display: flex;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 50%;
            margin: 0 3px;
            opacity: 0.4;
        }

        .typing-dot:nth-child(1) {
            animation: typingAnimation 1s infinite;
        }

        .typing-dot:nth-child(2) {
            animation: typingAnimation 1s infinite 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation: typingAnimation 1s infinite 0.4s;
        }

        @keyframes typingAnimation {
            0%, 100% { opacity: 0.4; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-5px); }
        }

        /* Enhanced Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: var(--gradient);
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            color: white;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .app-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: -5px;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Enhanced Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: var(--border-radius);
            padding: 8px;
            margin: 20px 5% 30px;
            box-shadow: var(--box-shadow);
            gap: 5px;
            overflow-x: auto;
        }

        .dark-mode .nav-tabs {
            background: var(--dark-color);
        }

        .nav-tab {
            padding: 12px 24px;
            border-radius: var(--border-radius-sm);
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(108, 99, 255, 0.1);
            color: var(--primary-color);
        }

        .nav-tab.active {
            background: var(--gradient);
            color: white;
            box-shadow: var(--box-shadow);
        }

        /* Accessibility Panel */
        .accessibility-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: 20px;
            z-index: 1000;
            transform: translateX(calc(100% + 20px));
            transition: var(--transition);
            border: 1px solid #eee;
            width: 280px;
        }

        .dark-mode .accessibility-panel {
            background: var(--dark-color);
            color: var(--text-color);
            border-color: #444;
        }

        .accessibility-panel.open {
            transform: translateX(0);
        }

        .accessibility-option {
            margin-bottom: 15px;
        }

        .accessibility-option label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: 500;
        }

        .font-size-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .font-size-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .dark-mode .font-size-btn {
            background: var(--dark-color);
            color: var(--text-color);
            border-color: #555;
        }

        .font-size-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Voice Activation */
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 12px;
            background: rgba(108, 99, 255, 0.1);
            border-radius: var(--border-radius-sm);
        }

        .voice-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ddd;
            transition: var(--transition);
        }

        .voice-indicator.listening {
            background: var(--success-color);
            animation: pulse 1s infinite;
        }

        .voice-command-feedback {
            margin-top: 10px;
            padding: 10px 12px;
            background: rgba(108, 99, 255, 0.1);
            border-radius: var(--border-radius-sm);
            font-style: italic;
            min-height: 40px;
            font-size: 0.9rem;
        }

        /* Enhanced UI Components */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(108, 99, 255, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--text-color);
        }

        .dark-mode .btn-secondary {
            background: #333;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .dark-mode .btn-secondary:hover {
            background: #444;
        }

        .btn-record {
            background: var(--danger-color);
            color: white;
            padding: 14px 28px;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .btn-record:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4);
        }

        .btn-record.recording {
            background: var(--success-color);
            animation: pulse 1.5s infinite;
        }

        .btn-icon {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            cursor: pointer;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: white;
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Smaller Emergency Exit */
        .emergency-exit {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
        }

        .btn-emergency {
            background: var(--danger-color);
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: bold;
            font-size: 0.85rem;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
            transition: var(--transition);
        }

        .btn-emergency:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }

        section {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .dark-mode section {
            background: var(--dark-color);
            color: var(--text-color);
        }

        section:hover {
            box-shadow: var(--box-shadow-lg);
        }

        /* Journal Specific Styles */
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .journal-actions {
            display: flex;
            gap: 15px;
        }

        .journal-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .journal-card {
            background: var(--light-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .journal-card {
            background: #2a2a3a;
        }

        .journal-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }

        .journal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
        }

        .journal-card h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .journal-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-light);
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .journal-content {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .journal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .journal-tag {
            background: var(--light-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .dark-mode .journal-tag {
            background: #3a3a4a;
        }

        .journal-editor {
            background: var(--light-color);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-top: 30px;
        }

        .dark-mode .journal-editor {
            background: var(--dark-color);
        }

        .editor-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .editor-toolbar button {
            background: var(--light-color);
            border: none;
            padding: 10px 14px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .dark-mode .editor-toolbar button {
            background: #2a2a3a;
        }

        .editor-toolbar button:hover {
            background: #e2e8f0;
        }

        .dark-mode .editor-toolbar button:hover {
            background: #3a3a4a;
        }

        #journal-content {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 1em;
            line-height: 1.6;
            background: white;
            transition: var(--transition);
        }

        .dark-mode #journal-content {
            background: #2a2a3a;
            border-color: #444;
            color: var(--text-color);
        }

        #journal-content:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .editor-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            align-items: center;
        }

        .mood-selector {
            display: flex;
            gap: 8px;
        }

        .mood-btn {
            background: none;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.2s ease;
        }

        .dark-mode .mood-btn {
            border-color: #555;
        }

        .mood-btn.selected {
            border-color: var(--primary-color);
            background: rgba(108, 99, 255, 0.1);
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(108, 99, 255, 0.2);
        }

        .sentiment-analysis {
            margin-top: 15px;
            padding: 16px;
            border-radius: var(--border-radius-sm);
            background: rgba(108, 99, 255, 0.1);
            border-left: 4px solid var(--primary-color);
            display: none;
        }

        .dark-mode .sentiment-analysis {
            background: rgba(108, 99, 255, 0.15);
        }

        /* Emotional state indicators */
        .mood-peaceful { color: #4CAF50; }
        .mood-hopeful { color: #2196F3; }
        .mood-neutral { color: #FFC107; }
        .mood-anxious { color: #FF9800; }
        .mood-overwhelmed { color: #F44336; }

        /* SolidarityCast Styles */
        .cast-intro {
            text-align: center;
            padding: 40px 30px;
            background: var(--gradient);
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .cast-intro h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
        }

        .cast-intro p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto 20px;
        }

        .safety-features {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-top: 40px;
            gap: 25px;
        }

        .safety-feature {
            flex: 1;
            min-width: 200px;
            text-align: center;
            padding: 30px 20px;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.2);
            position: relative;
            transition: var(--transition);
        }

        .safety-feature:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }

        .safety-feature i {
            font-size: 3rem;
            color: white;
            margin-bottom: 20px;
        }

        .safety-feature h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .safety-feature p {
            opacity: 0.9;
        }

        .feature-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            margin-bottom: 10px;
            box-shadow: var(--box-shadow);
        }

        .safety-feature:hover .feature-tooltip {
            opacity: 1;
        }

        .ai-assistant-container {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .dark-mode .ai-assistant-container {
            border-color: #444;
        }

        .ai-assistant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--gradient);
            color: white;
        }

        .ai-chat-container {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: var(--light-color);
        }

        .dark-mode .ai-chat-container {
            background: #2a2a3a;
        }

        .ai-message, .user-message {
            display: flex;
            margin-bottom: 20px;
        }

        .ai-message {
            align-items: flex-start;
        }

        .user-message {
            flex-direction: row-reverse;
            align-items: flex-start;
        }

        .ai-avatar, .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 12px;
            flex-shrink: 0;
        }

        .ai-avatar {
            background: var(--gradient);
            color: white;
        }

        .user-avatar {
            background: #e0e0e0;
            color: var(--text-color);
        }

        .dark-mode .user-avatar {
            background: #444;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .ai-message .message-content {
            background: white;
            border-top-left-radius: 8px;
        }

        .dark-mode .ai-message .message-content {
            background: #333;
        }

        .user-message .message-content {
            background: var(--primary-color);
            color: white;
            border-top-right-radius: 8px;
        }

        .quick-reply-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-reply-btn {
            background: rgba(108, 99, 255, 0.1);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .quick-reply-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .ai-input-container {
            display: flex;
            padding: 20px;
            border-top: 1px solid #ddd;
            background: white;
        }

        .dark-mode .ai-input-container {
            background: var(--dark-color);
            border-color: #444;
        }

        #ai-user-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 24px;
            padding: 12px 20px;
            resize: none;
            font-family: inherit;
            transition: var(--transition);
        }

        .dark-mode #ai-user-input {
            background: #2a2a3a;
            border-color: #444;
            color: var(--text-color);
        }

        #ai-user-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .recorder-display {
            background: #f5f5f7;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            margin: 25px 0;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .recorder-display {
            background: #2a2a3a;
        }

        .recorder-visualizer {
            width: 100%;
            height: 120px;
            margin-bottom: 20px;
        }

        .recorder-time {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .recorder-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        .cast-mood-selector {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            justify-content: center;
        }

        .cast-mood-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            border-radius: 24px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .dark-mode .cast-mood-btn {
            background: #333;
            border-color: #555;
            color: var(--text-color);
        }

        .cast-mood-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
        }

        .audio-upload-option {
            margin: 25px 0;
            padding: 20px;
            background: rgba(108, 99, 255, 0.05);
            border-radius: var(--border-radius);
        }

        .upload-progress {
            display: none;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .dark-mode .progress-bar {
            background: #444;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .recording-tips {
            margin-top: 25px;
            padding: 20px;
            background: rgba(108, 99, 255, 0.05);
            border-radius: var(--border-radius);
        }

        .recording-tips ul {
            list-style: none;
            padding: 0;
        }

        .recording-tips li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .recording-tips i {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .library-filters {
            display: flex;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        select, input[type="text"] {
            padding: 10px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius-sm);
            background: white;
            font-family: inherit;
            transition: var(--transition);
        }

        .dark-mode select, .dark-mode input[type="text"] {
            background: #333;
            border-color: #555;
            color: var(--text-color);
        }

        select:focus, input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .cast-list, .saved-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .cast-item, .saved-item {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 25px;
            transition: var(--transition);
            background: white;
        }

        .dark-mode .cast-item, .dark-mode .saved-item {
            border-color: #444;
            background: var(--dark-color);
        }

        .cast-item:hover, .saved-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-lg);
        }

        .no-recordings {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .no-recordings i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }

        /* Consent Modal */
        .consent-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .consent-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            box-shadow: var(--box-shadow-lg);
        }

        .dark-mode .consent-content {
            background: var(--dark-color);
            color: var(--text-color);
        }

        .consent-section {
            margin-bottom: 30px;
        }

        .consent-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
        }

        .consent-checkbox input {
            margin-top: 5px;
        }

        .consent-actions {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 30px;
        }

        /* Security Badge */
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 24px;
            color: var(--success-color);
            font-size: 0.9rem;
            margin: 15px 0;
            font-weight: 500;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            box-shadow: var(--box-shadow-lg);
        }

        .dark-mode .modal-content {
            background: var(--dark-color);
            color: var(--text-color);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(0,0,0,0.1);
        }

        .dark-mode .modal-close:hover {
            background: rgba(255,255,255,0.1);
        }

        .recording-player {
            margin: 25px 0;
            padding: 25px;
            background: #f5f5f7;
            border-radius: var(--border-radius);
        }

        .dark-mode .recording-player {
            background: #2a2a3a;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
            transition: var(--transition);
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(108, 99, 255, 0.4);
        }

        .time-display {
            font-size: 1rem;
            color: var(--text-light);
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .dark-mode .progress-bar {
            background: #444;
        }

        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .ai-feedback {
            margin: 25px 0;
            padding: 25px;
            background: rgba(108, 99, 255, 0.05);
            border-radius: var(--border-radius);
        }

        .feedback-result {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .feedback-result.positive i {
            color: var(--success-color);
        }

        .feedback-result.caution i {
            color: var(--warning-color);
        }

        .feedback-result.negative i {
            color: var(--danger-color);
        }

        .recording-options {
            margin: 25px 0;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .recording-title, .recording-tags {
            margin: 20px 0;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 30px;
        }

        /* Focus styles for accessibility */
        button:focus, select:focus, input:focus, textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 10px;
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 0 0 4px 4px;
            text-decoration: none;
            z-index: 10000;
            transition: top 0.3s;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-header {
                padding: 12px 20px;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .nav-tabs {
                margin: 15px 20px 25px;
                padding: 6px;
            }
            
            .nav-tab {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            .app-container {
                padding: 0 15px 30px;
            }
            
            section {
                padding: 25px 20px;
                margin-bottom: 30px;
            }
            
            .safety-features {
                flex-direction: column;
            }
            
            .library-filters {
                flex-direction: column;
            }
            
            .recorder-controls {
                flex-wrap: wrap;
            }
            
            .modal-content, .consent-content {
                width: 95%;
                padding: 30px 20px;
            }
            
            .modal-actions, .consent-actions {
                flex-direction: column;
            }
            
            .accessibility-panel {
                top: 80px;
                right: 15px;
                width: 260px;
            }
            
            .journal-list {
                grid-template-columns: 1fr;
            }
            
            .journal-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .cast-list, .saved-list {
                grid-template-columns: 1fr;
            }
        }

        /* Font size classes */
        .font-small {
            font-size: 14px;
        }

        .font-medium {
            font-size: 16px;
        }

        .font-large {
            font-size: 18px;
        }

        .font-x-large {
            font-size: 20px;
        }
    </style>
</head>
<body class="trauma-informed">
    <!-- Consent Agreement Modal -->
    <div class="consent-modal" id="consent-modal">
        <div class="consent-content">
            <h2>Welcome to SafeSpace Studio</h2>
            <p>Before you begin, please review and agree to our terms of service and privacy policy.</p>
            
            <div class="consent-section">
                <h3>Data Privacy & Security</h3>
                <p>We are committed to protecting your privacy and ensuring the security of your data:</p>
                <ul>
                    <li>All recordings and journal entries are encrypted end-to-end</li>
                    <li>No personally identifiable information is stored</li>
                    <li>You maintain full control over your content</li>
                    <li>Data is automatically deleted after 30 days of inactivity</li>
                </ul>
                
                <div class="consent-checkbox">
                    <input type="checkbox" id="consent-privacy" required>
                    <label for="consent-privacy">I understand and agree to the data privacy and security measures</label>
                </div>
            </div>
            
            <div class="consent-section">
                <h3>Content Guidelines</h3>
                <p>To maintain a safe environment for all users:</p>
                <ul>
                    <li>Content must not promote harm, violence, or illegal activities</li>
                    <li>Respect the experiences and identities of others</li>
                    <li>No hate speech, harassment, or discriminatory content</li>
                    <li>AI monitoring helps identify potentially harmful content</li>
                </ul>
                
                <div class="consent-checkbox">
                    <input type="checkbox" id="consent-guidelines" required>
                    <label for="consent-guidelines">I agree to follow the content guidelines</label>
                </div>
            </div>
            
            <div class="consent-section">
                <h3>Emotional Safety & Support</h3>
                <p>Sharing personal experiences can be emotionally challenging:</p>
                <ul>
                    <li>You can pause or stop recording at any time</li>
                    <li>Our AI assistant provides emotional support</li>
                    <li>Crisis resources are available if needed</li>
                    <li>You maintain full control over what you share</li>
                </ul>
                
                <div class="consent-checkbox">
                    <input type="checkbox" id="consent-safety" required>
                    <label for="consent-safety">I understand the emotional safety measures and resources available</label>
                </div>
            </div>
            
            <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                <span>End-to-End Encryption Enabled</span>
            </div>
            
            <div class="consent-actions">
                <button class="btn-secondary" id="decline-consent">Decline</button>
                <button class="btn-primary" id="accept-consent" disabled>Accept & Continue</button>
            </div>
        </div>
    </div>
    
    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Accessibility Panel -->
    <div class="accessibility-panel" id="accessibility-panel">
        <h3>Accessibility Options</h3>
        
        <div class="accessibility-option">
            <label>
                <input type="checkbox" id="toggle-darkmode">
                <span>Dark Mode</span>
            </label>
        </div>
        
        <div class="accessibility-option">
            <label>
                <input type="checkbox" id="toggle-high-contrast">
                <span>High Contrast</span>
            </label>
        </div>
        
        <div class="accessibility-option">
            <label>
                <input type="checkbox" id="toggle-reduced-motion">
                <span>Reduce Motion</span>
            </label>
        </div>
        
        <div class="accessibility-option">
            <label>Font Size:</label>
            <div class="font-size-controls">
                <button class="font-size-btn" data-size="small">A-</button>
                <button class="font-size-btn active" data-size="medium">A</button>
                <button class="font-size-btn" data-size="large">A+</button>
                <button class="font-size-btn" data-size="x-large">A++</button>
            </div>
        </div>
        
        <div class="accessibility-option">
            <label>Voice Control:</label>
            <div class="voice-controls">
                <button class="btn-secondary" id="toggle-voice-control">
                    <i class="fas fa-microphone"></i> Enable Voice
                </button>
                <div class="voice-indicator" id="voice-indicator"></div>
            </div>
            <div class="voice-command-feedback" id="voice-command-feedback">
                Voice commands disabled. Click "Enable Voice" to start.
            </div>
        </div>
    </div>
    
    <!-- Smaller Emergency Exit -->
    <div class="emergency-exit">
        <a href="https://www.google.com" class="btn-emergency pulse">
            <i class="fas fa-door-open"></i> Quick Exit
        </a>
    </div>
    
    <!-- Enhanced Header -->
    <header class="app-header">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-heart"></i>
            </div>
            <div>
                <h1 class="app-title">SafeSpace Studio</h1>
                <p class="app-subtitle">Your Journey to Healing & Empowerment</p>
            </div>
        </div>
        <div class="user-actions">
            <button class="btn-icon" id="cast-help" title="Get Help" aria-label="Get Help">
                <i class="fas fa-question-circle"></i>
            </button>
            <button class="btn-icon" id="toggle-accessibility" title="Accessibility Options" aria-label="Accessibility Options">
                <i class="fas fa-universal-access"></i>
            </button>
        </div>
    </header>
    
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <a href="#journal" class="nav-tab active">
            <i class="fas fa-book"></i> Journal
        </a>
        <a href="#solidarity-cast" class="nav-tab">
            <i class="fas fa-microphone"></i> SolidarityCast
        </a>
        <a href="#" class="nav-tab">
            <i class="fas fa-vault"></i> EmpowerVault
        </a>
        <a href="#" class="nav-tab">
            <i class="fas fa-path"></i> ReclaimPath
        </a>
        <a href="#" class="nav-tab">
            <i class="fas fa-users"></i> Community
        </a>
        <a href="#" class="nav-tab">
            <i class="fas fa-gavel"></i> Justice Ally
        </a>
    </div>
    
    <!-- Main Content -->
    <div class="app-container">
        <main id="main-content">
            <!-- Journal Section -->
            <section id="journal" class="journal-section">
                <div class="journal-header">
                    <h2>Your Private Journal</h2>
                    <div class="journal-actions">
                        <button class="btn-secondary" id="filter-entries">
                            <i class="fas fa-filter"></i>
                            Filter
                        </button>
                        <button class="btn-primary" id="new-entry">
                            <i class="fas fa-plus"></i>
                            New Entry
                        </button>
                    </div>
                </div>

                <!-- Journal Entries List -->
                <div class="journal-list" id="journal-list">
                    <!-- Entry 1 -->
                    <div class="journal-card">
                        <div class="journal-meta">
                            <span class="journal-date">Today, 10:30 AM</span>
                            <span class="journal-mood mood-hopeful">ðŸ˜Š Hopeful</span>
                        </div>
                        <h3>Breakthrough in Therapy</h3>
                        <div class="journal-content">
                            <p>Today I finally talked about the incident from last year. It was hard but I feel lighter now. My therapist helped me see it wasn't my fault...</p>
                        </div>
                        <div class="journal-tags">
                            <span class="journal-tag">therapy</span>
                            <span class="journal-tag">progress</span>
                            <span class="journal-tag">healing</span>
                        </div>
                        <button class="btn-small" style="margin-top: 15px;">Read More</button>
                    </div>
                    
                    <!-- Entry 2 -->
                    <div class="journal-card">
                        <div class="journal-meta">
                            <span class="journal-date">Yesterday, 8:15 PM</span>
                            <span class="journal-mood mood-anxious">ðŸ˜Ÿ Anxious</span>
                        </div>
                        <h3>Court Date Approaching</h3>
                        <div class="journal-content">
                            <p>Only 3 days until the hearing. I'm nervous but prepared. Reviewed all my evidence with the lawyer today...</p>
                        </div>
                        <div class="journal-tags">
                            <span class="journal-tag">legal</span>
                            <span class="journal-tag">self-care</span>
                            <span class="journal-tag">strength</span>
                        </div>
                        <button class="btn-small" style="margin-top: 15px;">Read More</button>
                    </div>
                    
                    <!-- Entry 3 -->
                    <div class="journal-card">
                        <div class="journal-meta">
                            <span class="journal-date">May 15, 2:45 PM</span>
                            <span class="journal-mood mood-peaceful">ðŸ˜Œ Peaceful</span>
                        </div>
                        <h3>Nature Walk</h3>
                        <div class="journal-content">
                            <p>Took a long walk in the park today. The sunlight through the trees was beautiful. For the first time in months, I felt truly present...</p>
                        </div>
                        <div class="journal-tags">
                            <span class="journal-tag">healing</span>
                            <span class="journal-tag">nature</span>
                            <span class="journal-tag">mindfulness</span>
                        </div>
                        <button class="btn-small" style="margin-top: 15px;">Read More</button>
                    </div>
                </div>

                <!-- Journal Editor (Initially Hidden) -->
                <div class="journal-editor" id="journal-editor" style="display: none;">
                    <h3>New Journal Entry</h3>
                    <div class="editor-toolbar">
                        <button type="button" title="Bold" aria-label="Bold text"><i class="fas fa-bold"></i></button>
                        <button type="button" title="Italic" aria-label="Italic text"><i class="fas fa-italic"></i></button>
                        <button type="button" title="Underline" aria-label="Underline text"><i class="fas fa-underline"></i></button>
                        <button type="button" title="Bullet List" aria-label="Bullet list"><i class="fas fa-list-ul"></i></button>
                        <button type="button" title="Numbered List" aria-label="Numbered list"><i class="fas fa-list-ol"></i></button>
                    </div>
                    
                    <textarea id="journal-content" placeholder="Write freely here... your words are safe and private."></textarea>
                    
                    <div class="sentiment-analysis" id="sentiment-analysis">
                        <strong>AI Emotional Check:</strong>
                        <p>This entry seems to express <span id="sentiment-result">hope and progress</span>.</p>
                        <p>Would you like to add any resources that might help?</p>
                    </div>
                    
                    <div class="editor-footer">
                        <div class="mood-selector">
                            <span style="margin-right: 10px;">Mood:</span>
                            <button type="button" class="mood-btn" data-mood="peaceful" aria-label="Peaceful">ðŸ˜Œ</button>
                            <button type="button" class="mood-btn" data-mood="hopeful" aria-label="Hopeful">ðŸ˜Š</button>
                            <button type="button" class="mood-btn" data-mood="neutral" aria-label="Neutral">ðŸ˜</button>
                            <button type="button" class="mood-btn" data-mood="anxious" aria-label="Anxious">ðŸ˜Ÿ</button>
                            <button type="button" class="mood-btn" data-mood="overwhelmed" aria-label="Overwhelmed">ðŸ˜£</button>
                        </div>
                        
                        <div>
                            <button type="button" class="btn-secondary" id="cancel-entry">Cancel</button>
                            <button type="button" class="btn-primary" id="save-entry">Save Entry</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SolidarityCast Section -->
            <section id="solidarity-cast" class="solidarity-section" style="display: none;">
                <div class="cast-intro animate__animated animate__fadeIn">
                    <h2>Share Your Story Safely <i class="fas fa-hands-helping" aria-hidden="true"></i></h2>
                    <p class="cast-description">Record anonymous audio narratives to educate, advocate, and connect with others. Our AI ensures emotional safety while preserving your anonymity.</p>
                    
                    <div class="security-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Your Privacy & Security Are Protected</span>
                    </div>
                    
                    <div class="safety-features">
                        <div class="safety-feature hover-grow">
                            <i class="fas fa-user-secret" aria-hidden="true"></i>
                            <h4>100% Anonymous</h4>
                            <p>Your identity is protected</p>
                            <div class="feature-tooltip">We never ask for or store personal information</div>
                        </div>
                        <div class="safety-feature hover-grow">
                            <i class="fas fa-robot" aria-hidden="true"></i>
                            <h4>AI Companion</h4>
                            <p>Guides you through sharing</p>
                            <div class="feature-tooltip">Our assistant helps prepare and support you</div>
                        </div>
                        <div class="safety-feature hover-grow">
                            <i class="fas fa-sliders-h" aria-hidden="true"></i>
                            <h4>Complete Control</h4>
                            <p>Edit or delete anytime</p>
                            <div class="feature-tooltip">You decide what to share and when</div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Chatbot Section -->
                <section class="ai-assistant-section">
                    <div class="ai-assistant-container">
                        <div class="ai-assistant-header">
                            <h3><i class="fas fa-robot" aria-hidden="true"></i> Trauma-Informed Assistant</h3>
                            <button class="btn-icon" id="minimize-chatbot" aria-label="Minimize chatbot">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                        <div class="ai-chat-container" id="ai-chat-container">
                            <div class="ai-message">
                                <div class="ai-avatar">
                                    <i class="fas fa-robot" aria-hidden="true"></i>
                                </div>
                                <div class="message-content">
                                    <p>Hello, I'm your trauma-informed assistant. I'm here to help you prepare for recording your story, answer questions about the process, or just listen if you need support. How can I help you today?</p>
                                    <div class="quick-reply-buttons">
                                        <button class="quick-reply-btn" data-message="How does the recording process work?">How does recording work?</button>
                                        <button class="quick-reply-btn" data-message="I'm nervous about sharing">I'm nervous about sharing</button>
                                        <button class="quick-reply-btn" data-message="What happens after I record?">What happens after recording?</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-input-container">
                            <textarea id="ai-user-input" placeholder="Type your message here..." rows="1" aria-label="Type your message to the AI assistant"></textarea>
                            <button id="ai-send-btn" class="btn-icon" aria-label="Send message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </section>
                
                <section class="cast-recording">
                    <div class="recording-card">
                        <h3>Create Your SolidarityCast</h3>
                        
                        <div class="topic-selection">
                            <label for="cast-topic">What would you like to share about?</label>
                            <select id="cast-topic">
                                <option value="">Select a topic</option>
                                <option value="healing">My Healing Journey</option>
                                <option value="advice">Advice for Others</option>
                                <option value="system">Experiences with the System</option>
                                <option value="hope">Messages of Hope</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="emotional-check">
                            <p>Before recording, how are you feeling about sharing?</p>
                            <div class="cast-mood-selector">
                                <button data-mood="ready" class="cast-mood-btn">Ready</button>
                                <button data-mood="nervous" class="cast-mood-btn">Nervous</button>
                                <button data-mood="unsure" class="cast-mood-btn">Unsure</button>
                            </div>
                            <p class="emotional-feedback" id="emotional-feedback">Our AI will check in during recording to ensure you're comfortable.</p>
                        </div>
                        
                        <div class="recorder-container">
                            <div class="recorder-display" id="recorder-display">
                                <canvas class="recorder-visualizer" id="audio-visualizer" width="400" height="100"></canvas>
                                <div class="recorder-time" id="recorder-time">00:00</div>
                            </div>
                            
                            <div class="recorder-controls">
                                <button class="btn-record" id="start-recording">
                                    <i class="fas fa-microphone"></i>
                                    <span>Start Recording</span>
                                </button>
                                <button class="btn-secondary" id="pause-recording" disabled>
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="btn-secondary" id="stop-recording" disabled>
                                    <i class="fas fa-stop"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Audio Upload Option -->
                        <div class="audio-upload-option">
                            <p>Or upload a pre-recorded audio file:</p>
                            <input type="file" id="audio-upload" accept="audio/*" style="display: none;">
                            <button class="btn-secondary" id="upload-audio-btn">
                                <i class="fas fa-upload"></i> Upload Audio
                            </button>
                            <div id="upload-progress" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="upload-progress-fill"></div>
                                </div>
                                <span id="upload-percentage">0%</span>
                            </div>
                        </div>
                        
                        <div class="recording-tips">
                            <h4>Recording Tips</h4>
                            <ul>
                                <li><i class="fas fa-volume-mute"></i> Find a quiet, private space</li>
                                <li><i class="fas fa-comment-dots"></i> Speak naturally - this isn't a performance</li>
                                <li><i class="fas fa-coffee"></i> Take breaks if needed</li>
                                <li><i class="fas fa-edit"></i> You can always edit or delete later</li>
                            </ul>
                        </div>
                    </div>
                </section>
                
                <section class="cast-library">
                    <h3>Community SolidarityCasts</h3>
                    <div class="library-filters">
                        <div class="filter-group">
                            <label for="filter-topic">Filter by Topic:</label>
                            <select id="filter-topic">
                                <option value="all">All Topics</option>
                                <option value="healing">Healing Journeys</option>
                                <option value="advice">Advice & Support</option>
                                <option value="system">System Experiences</option>
                                <option value="hope">Messages of Hope</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-length">Filter by Length:</label>
                            <select id="filter-length">
                                <option value="all">Any Length</option>
                                <option value="short">Under 5 min</option>
                                <option value="medium">5-15 min</option>
                                <option value="long">15+ min</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="cast-list" id="cast-list">
                        <!-- Cast items will be loaded here dynamically -->
                        <div class="no-recordings">
                            <i class="fas fa-headphones"></i>
                            <p>No community recordings available yet. Be the first to share your story!</p>
                        </div>
                    </div>
                    
                    <div class="saved-recordings">
                        <h3>Your Saved Recordings</h3>
                        <div class="saved-list" id="saved-list">
                            <!-- User's saved recordings will appear here -->
                            <div class="no-recordings">
                                <i class="fas fa-microphone-slash"></i>
                                <p>You don't have any saved recordings yet.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </section>
        </main>
    </div>
    
    <!-- Recording Review Modal -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close" aria-label="Close modal">&times;</button>
            <h2>Review Your Recording</h2>
            <div class="recording-player">
                <div class="waveform-display" id="waveform-display"></div>
                <div class="player-controls">
                    <button class="play-btn" id="modal-play-btn" aria-label="Play recording">
                        <i class="fas fa-play"></i>
                    </button>
                    <div class="time-display" id="modal-time-display">00:00 / 00:00</div>
                    <input type="range" class="progress-bar" id="modal-progress-bar" min="0" max="100" value="0" aria-label="Audio progress">
                </div>
                <audio id="audio-player" style="display: none;"></audio>
            </div>
            
            <div class="ai-feedback">
                <h3>AI Emotional Safety Check</h3>
                <div class="feedback-result" id="ai-feedback-result">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Analyzing your recording for emotional safety...</p>
                </div>
                <div class="feedback-note" id="ai-feedback-note">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="recording-options">
                <h3>Sharing Options</h3>
                <div class="option-group">
                    <input type="checkbox" id="anon-sharing" checked>
                    <label for="anon-sharing">Share Anonymously</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="allow-comments">
                    <label for="allow-comments">Allow Community Responses</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="educ-resource">
                    <label for="educ-resource">Allow use as educational resource</label>
                </div>
                
                <div class="recording-title">
                    <label for="recording-title">Title (optional):</label>
                    <input type="text" id="recording-title" placeholder="Give your recording a title">
                </div>
                
                <div class="recording-tags">
                    <label for="recording-tags">Tags (comma separated):</label>
                    <input type="text" id="recording-tags" placeholder="healing, recovery, advice">
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" id="save-draft">
                    <i class="fas fa-save"></i> Save Draft
                </button>
                <button class="btn-secondary" id="delete-recording">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
                <button class="btn-primary" id="publish-recording">
                    <i class="fas fa-share-square"></i> Publish to SolidarityCast
                </button>
            </div>
        </div>
    </div>
    
    <!-- AI Chatbot Fine-Tuning Configuration (hidden) -->
    <div id="ai-config" style="display: none;">
        <!-- This would contain the fine-tuned model parameters -->
        <script id="ai-model">
            // This would be replaced with actual fine-tuned model parameters
            const aiConfig = {
                modelName: "trauma-informed-gpt",
                temperature: 0.7,
                maxTokens: 150,
                prompts: {
                    greeting: "I'm your trauma-informed assistant. I'm here to help you prepare for recording your story, answer questions about the process, or just listen if you need support.",
                    recordingHelp: "The recording process is completely anonymous. You can record for as long as you feel comfortable, and our AI will check the emotional tone to ensure it's safe for you to share. You can always pause, stop, or delete your recording.",
                    nervousResponse: "It's completely normal to feel nervous about sharing your story. Remember, you're in control here - you can record at your own pace, edit or delete anything you're not comfortable with, and choose exactly how your story is shared.",
                    postRecording: "After recording, you'll have a chance to review it. Our AI will analyze it for emotional safety and suggest edits if it detects potentially distressing content. Then you can choose to save it privately, share anonymously, or delete it."
                },
                safetyTriggers: {
                    keywords: ["suicide", "self-harm", "abuse"],
                    responses: {
                        crisis: "I'm concerned about what you're sharing. Would you like me to connect you with a crisis counselor?",
                        resources: "What you're describing sounds difficult. Here are some resources that might help: [list of resources]",
                        support: "Thank you for sharing this with me. You're not alone - would you like me to suggest some support options?"
                    }
                }
            };
        </script>
    </div>
    
    <!-- RecordRTC for audio recording -->
    <script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>
    
    <script>
        // Enhanced JavaScript for the new features
        document.addEventListener('DOMContentLoaded', function() {
            // Tab Navigation
            const navTabs = document.querySelectorAll('.nav-tab');
            const journalSection = document.getElementById('journal');
            const solidaritySection = document.getElementById('solidarity-cast');
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active tab
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show/hide sections
                    if (this.getAttribute('href') === '#journal') {
                        journalSection.style.display = 'block';
                        solidaritySection.style.display = 'none';
                    } else if (this.getAttribute('href') === '#solidarity-cast') {
                        journalSection.style.display = 'none';
                        solidaritySection.style.display = 'block';
                    }
                });
            });
            
            // Consent Agreement
            const consentModal = document.getElementById('consent-modal');
            const consentCheckboxes = document.querySelectorAll('.consent-checkbox input');
            const acceptConsentBtn = document.getElementById('accept-consent');
            const declineConsentBtn = document.getElementById('decline-consent');
            
            // Show consent modal on page load
            consentModal.style.display = 'flex';
            
            // Check if all consent boxes are checked
            function checkConsent() {
                const allChecked = Array.from(consentCheckboxes).every(checkbox => checkbox.checked);
                acceptConsentBtn.disabled = !allChecked;
            }
            
            // Add event listeners to consent checkboxes
            consentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', checkConsent);
            });
            
            // Handle consent acceptance
            acceptConsentBtn.addEventListener('click', function() {
                consentModal.style.display = 'none';
                localStorage.setItem('solidarityCastConsent', 'accepted');
                // Enable recording functionality
                initializeRecording();
            });
            
            // Handle consent decline
            declineConsentBtn.addEventListener('click', function() {
                alert('You must accept the terms to use SafeSpace Studio. Redirecting...');
                window.location.href = 'https://www.google.com';
            });
            
            // Check if user has already consented
            if (localStorage.getItem('solidarityCastConsent') === 'accepted') {
                consentModal.style.display = 'none';
                initializeRecording();
            }
            
            function initializeRecording() {
                // All recording functionality will be initialized here
                console.log('Recording functionality enabled');
            }
            
            // Accessibility Features
            const accessibilityPanel = document.getElementById('accessibility-panel');
            const toggleAccessibilityBtn = document.getElementById('toggle-accessibility');
            const toggleDarkMode = document.getElementById('toggle-darkmode');
            const toggleHighContrast = document.getElementById('toggle-high-contrast');
            const toggleReducedMotion = document.getElementById('toggle-reduced-motion');
            const fontSizeButtons = document.querySelectorAll('.font-size-btn');
            const toggleVoiceControl = document.getElementById('toggle-voice-control');
            const voiceIndicator = document.getElementById('voice-indicator');
            const voiceCommandFeedback = document.getElementById('voice-command-feedback');
            
            // Toggle accessibility panel
            toggleAccessibilityBtn.addEventListener('click', function() {
                accessibilityPanel.classList.toggle('open');
            });
            
            // Close accessibility panel when clicking outside
            document.addEventListener('click', function(e) {
                if (!accessibilityPanel.contains(e.target) && e.target !== toggleAccessibilityBtn) {
                    accessibilityPanel.classList.remove('open');
                }
            });
            
            // Dark mode toggle
            toggleDarkMode.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', this.checked);
            });
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                toggleDarkMode.checked = true;
                document.body.classList.add('dark-mode');
            }
            
            // High contrast mode
            toggleHighContrast.addEventListener('change', function() {
                document.body.classList.toggle('high-contrast');
                localStorage.setItem('highContrast', this.checked);
            });
            
            // Check for saved high contrast preference
            if (localStorage.getItem('highContrast') === 'true') {
                toggleHighContrast.checked = true;
                document.body.classList.add('high-contrast');
            }
            
            // Reduced motion
            toggleReducedMotion.addEventListener('change', function() {
                document.body.classList.toggle('reduced-motion');
                localStorage.setItem('reducedMotion', this.checked);
            });
            
            // Check for saved reduced motion preference
            if (localStorage.getItem('reducedMotion') === 'true') {
                toggleReducedMotion.checked = true;
                document.body.classList.add('reduced-motion');
            }
            
            // Font size controls
            fontSizeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const size = this.getAttribute('data-size');
                    
                    // Remove all font size classes
                    document.body.classList.remove('font-small', 'font-medium', 'font-large', 'font-x-large');
                    
                    // Add selected font size class
                    document.body.classList.add(`font-${size}`);
                    
                    // Update active button
                    fontSizeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    localStorage.setItem('fontSize', size);
                });
            });
            
            // Check for saved font size preference
            const savedFontSize = localStorage.getItem('fontSize') || 'medium';
            document.body.classList.add(`font-${savedFontSize}`);
            document.querySelector(`.font-size-btn[data-size="${savedFontSize}"]`).classList.add('active');
            
            // Voice Control
            let recognition;
            let isListening = false;
            
            // Check if browser supports speech recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isListening = true;
                    voiceIndicator.classList.add('listening');
                    voiceCommandFeedback.textContent = "Listening... Speak now.";
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase();
                    voiceCommandFeedback.textContent = `Heard: "${transcript}"`;
                    
                    // Process voice commands
                    processVoiceCommand(transcript);
                    
                    // Restart listening after a short delay
                    setTimeout(() => {
                        if (isListening) {
                            recognition.start();
                        }
                    }, 1000);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    voiceCommandFeedback.textContent = `Error: ${event.error}. Try again.`;
                    isListening = false;
                    voiceIndicator.classList.remove('listening');
                };
                
                recognition.onend = function() {
                    isListening = false;
                    voiceIndicator.classList.remove('listening');
                    if (toggleVoiceControl.textContent.includes('Disable')) {
                        voiceCommandFeedback.textContent = "Stopped listening. Click 'Enable Voice' to restart.";
                    }
                };
            } else {
                // Browser doesn't support speech recognition
                toggleVoiceControl.disabled = true;
                toggleVoiceControl.innerHTML = '<i class="fas fa-microphone-slash"></i> Voice Not Supported';
                voiceCommandFeedback.textContent = "Voice commands are not supported in your browser.";
            }
            
            toggleVoiceControl.addEventListener('click', function() {
                if (!recognition) return;
                
                if (isListening) {
                    recognition.stop();
                    isListening = false;
                    this.innerHTML = '<i class="fas fa-microphone"></i> Enable Voice';
                    voiceCommandFeedback.textContent = "Voice commands disabled.";
                } else {
                    recognition.start();
                    isListening = true;
                    this.innerHTML = '<i class="fas fa-microphone-slash"></i> Disable Voice';
                    voiceCommandFeedback.textContent = "Voice commands enabled. Say 'help' for available commands.";
                }
            });
            
            function processVoiceCommand(command) {
                // Normalize command
                command = command.toLowerCase().trim();
                
                // Available voice commands
                if (command.includes('help') || command.includes('what can i say')) {
                    voiceCommandFeedback.textContent = "Available commands: 'start recording', 'stop recording', 'upload audio', 'talk to assistant', 'dark mode', 'light mode', 'emergency exit'";
                } else if (command.includes('start recording') || command.includes('record')) {
                    if (localStorage.getItem('solidarityCastConsent') === 'accepted') {
                        document.getElementById('start-recording').click();
                        voiceCommandFeedback.textContent = "Starting recording...";
                    } else {
                        voiceCommandFeedback.textContent = "Please accept the consent agreement first.";
                    }
                } else if (command.includes('stop recording') || command.includes('stop')) {
                    document.getElementById('stop-recording').click();
                    voiceCommandFeedback.textContent = "Stopping recording...";
                } else if (command.includes('upload audio') || command.includes('upload')) {
                    document.getElementById('upload-audio-btn').click();
                    voiceCommandFeedback.textContent = "Opening file upload...";
                } else if (command.includes('talk to assistant') || command.includes('assistant')) {
                    document.getElementById('ai-user-input').focus();
                    voiceCommandFeedback.textContent = "Focusing on assistant chat. You can now speak to type.";
                } else if (command.includes('dark mode') || command.includes('dark')) {
                    toggleDarkMode.checked = true;
                    document.body.classList.add('dark-mode');
                    voiceCommandFeedback.textContent = "Dark mode enabled.";
                } else if (command.includes('light mode') || command.includes('light')) {
                    toggleDarkMode.checked = false;
                    document.body.classList.remove('dark-mode');
                    voiceCommandFeedback.textContent = "Light mode enabled.";
                } else if (command.includes('emergency exit') || command.includes('exit')) {
                    window.location.href = 'https://www.google.com';
                } else if (command.includes('accessibility') || command.includes('options')) {
                    accessibilityPanel.classList.toggle('open');
                    voiceCommandFeedback.textContent = accessibilityPanel.classList.contains('open') ? 
                        "Accessibility panel opened." : "Accessibility panel closed.";
                } else {
                    // If it's not a command, assume it's for the AI assistant
                    document.getElementById('ai-user-input').value = command;
                    document.getElementById('ai-send-btn').click();
                    voiceCommandFeedback.textContent = `Sent to assistant: "${command}"`;
                }
            }
            
            // AI Chatbot functionality
            const chatContainer = document.getElementById('ai-chat-container');
            const userInput = document.getElementById('ai-user-input');
            const sendBtn = document.getElementById('ai-send-btn');
            
            // Sample responses from our fine-tuned AI
            const aiResponses = {
                "default": "I'm here to support you. Could you tell me more about what's on your mind?",
                "How does recording work?": "The recording process is designed to be safe and easy. You can record directly through your microphone or upload an existing audio file. Our system will analyze the content for emotional safety while preserving your anonymity. You'll have full control over what gets shared.",
                "I'm nervous about sharing": "It's completely normal to feel nervous. Sharing personal experiences can be vulnerable. Remember: 1) You can stop anytime 2) Nothing will be shared without your explicit consent 3) Our AI checks help ensure emotional safety. Would you like to practice with a private recording first?",
                "What happens after I record?": "After recording, you'll review your audio. Our AI will highlight any potentially distressing sections (for your awareness only). You can then: 1) Save privately 2) Share anonymously to help others 3) Edit/delete sections 4) Discard completely. The choice is always yours.",
                "help": "I can help with: 1) Preparing to record 2) Understanding privacy protections 3) Navigating difficult emotions while sharing 4) Connecting you with resources. What would be most helpful right now?",
                "resources": "Here are some resources you might find helpful: [Resource list would be populated here based on user needs]. Would you like me to focus on any particular type of support?",
                "safety": "Your safety is our priority. All recordings are: 1) Encrypted end-to-end 2) Anonymous by default 3) Never shared without your explicit consent. Our AI checks help identify potentially distressing content before you share."
            };
            
            // Quick reply button functionality
            document.querySelectorAll('.quick-reply-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const message = this.getAttribute('data-message');
                    addUserMessage(message);
                    processAIResponse(message);
                });
            });
            
            // Send message function
            function sendMessage() {
                const message = userInput.value.trim();
                if (message) {
                    addUserMessage(message);
                    processAIResponse(message);
                    userInput.value = '';
                    // Reset textarea height
                    userInput.style.height = 'auto';
                }
            }
            
            // Auto-resize textarea
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Enter key to send (but allow shift+enter for new line)
            userInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            sendBtn.addEventListener('click', sendMessage);
            
            function addUserMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'user-message';
                messageDiv.innerHTML = `
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="message-content">
                        <p>${text}</p>
                    </div>
                `;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            function addAIMessage(text, isQuickReply = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'ai-message';
                
                let quickReplies = '';
                if (isQuickReply) {
                    quickReplies = `
                        <div class="quick-reply-buttons">
                            <button class="quick-reply-btn" data-message="How does the recording process work?">How does recording work?</button>
                            <button class="quick-reply-btn" data-message="I'm nervous about sharing">I'm nervous about sharing</button>
                            <button class="quick-reply-btn" data-message="What happens after I record?">What happens after recording?</button>
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = `
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <p>${text}</p>
                        ${quickReplies}
                    </div>
                `;
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Re-attach event listeners to new quick reply buttons
                if (isQuickReply) {
                    messageDiv.querySelectorAll('.quick-reply-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const message = this.getAttribute('data-message');
                            addUserMessage(message);
                            processAIResponse(message);
                        });
                    });
                }
            }
            
            function processAIResponse(userMessage) {
                // Simple response logic - in a real app, this would call an API
                let response = aiResponses.default;
                
                // Check for keywords
                userMessage = userMessage.toLowerCase();
                if (userMessage.includes('how') && userMessage.includes('work')) {
                    response = aiResponses["How does recording work?"];
                } else if (userMessage.includes('nervous') || userMessage.includes('scared') || userMessage.includes('anxious')) {
                    response = aiResponses["I'm nervous about sharing"];
                } else if (userMessage.includes('after') || userMessage.includes('next') || userMessage.includes('then what')) {
                    response = aiResponses["What happens after I record?"];
                } else if (userMessage.includes('help') || userMessage.includes('support')) {
                    response = aiResponses["help"];
                } else if (userMessage.includes('resource') || userMessage.includes('help')) {
                    response = aiResponses["resources"];
                } else if (userMessage.includes('safe') || userMessage.includes('private') || userMessage.includes('anonymous')) {
                    response = aiResponses["safety"];
                }
                
                // Simulate typing delay
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'ai-message';
                typingIndicator.innerHTML = `
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;
                chatContainer.appendChild(typingIndicator);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                setTimeout(() => {
                    chatContainer.removeChild(typingIndicator);
                    addAIMessage(response, true);
                }, 1500);
            }
            
            // Mood selector for SolidarityCast
            const castMoodButtons = document.querySelectorAll('.cast-mood-btn');
            const emotionalFeedback = document.getElementById('emotional-feedback');
            
            castMoodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    castMoodButtons.forEach(btn => btn.classList.remove('selected'));
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    
                    const mood = this.getAttribute('data-mood');
                    let feedback = '';
                    
                    switch(mood) {
                        case 'ready':
                            feedback = "Great! When you're ready, click 'Start Recording' to begin.";
                            break;
                        case 'nervous':
                            feedback = "That's completely normal. Remember, you're in control - you can pause or stop anytime. Would you like to chat with our assistant first?";
                            break;
                        case 'unsure':
                            feedback = "Take your time. You might want to browse other stories first or chat with our assistant to learn more about the process.";
                            break;
                    }
                    
                    emotionalFeedback.textContent = feedback;
                });
            });
            
            // Audio recording and upload functionality
            let mediaRecorder;
            let audioChunks = [];
            let audioContext;
            let analyser;
            let microphone;
            let recordingInterval;
            let recordingStartTime;
            let isPaused = false;
            
            document.getElementById('start-recording').addEventListener('click', startRecording);
            document.getElementById('pause-recording').addEventListener('click', pauseRecording);
            document.getElementById('stop-recording').addEventListener('click', stopRecording);
            document.getElementById('upload-audio-btn').addEventListener('click', () => {
                document.getElementById('audio-upload').click();
            });
            
            document.getElementById('audio-upload').addEventListener('change', handleAudioUpload);
            
            async function startRecording() {
                // Check if user has consented
                if (localStorage.getItem('solidarityCastConsent') !== 'accepted') {
                    alert('Please accept the consent agreement before recording.');
                    consentModal.style.display = 'flex';
                    return;
                }
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    
                    // Set up audio context for visualization
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    microphone = audioContext.createMediaStreamSource(stream);
                    microphone.connect(analyser);
                    
                    // Set up visualization
                    setupVisualizer();
                    
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        reviewRecording(audioBlob);
                    };
                    
                    mediaRecorder.start();
                    audioChunks = [];
                    recordingStartTime = Date.now();
                    isPaused = false;
                    
                    // Update timer
                    recordingInterval = setInterval(updateRecordingTime, 1000);
                    
                    // Update UI
                    document.getElementById('start-recording').classList.add('recording');
                    document.getElementById('start-recording').innerHTML = '<i class="fas fa-microphone"></i><span>Recording...</span>';
                    document.getElementById('start-recording').disabled = true;
                    document.getElementById('pause-recording').disabled = false;
                    document.getElementById('stop-recording').disabled = false;
                    
                } catch (error) {
                    console.error('Error starting recording:', error);
                    alert('Could not start recording. Please ensure microphone access is allowed.');
                }
            }
            
            function pauseRecording() {
                if (mediaRecorder.state === 'recording') {
                    mediaRecorder.pause();
                    clearInterval(recordingInterval);
                    document.getElementById('pause-recording').innerHTML = '<i class="fas fa-play"></i>';
                    isPaused = true;
                    document.getElementById('start-recording').classList.remove('recording');
                } else if (mediaRecorder.state === 'paused') {
                    mediaRecorder.resume();
                    recordingStartTime = Date.now() - (Date.now() - recordingStartTime);
                    recordingInterval = setInterval(updateRecordingTime, 1000);
                    document.getElementById('pause-recording').innerHTML = '<i class="fas fa-pause"></i>';
                    isPaused = false;
                    document.getElementById('start-recording').classList.add('recording');
                }
            }
            
            function stopRecording() {
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                clearInterval(recordingInterval);
                
                // Disconnect audio nodes
                if (microphone) microphone.disconnect();
                
                // Stop all tracks
                if (mediaRecorder && mediaRecorder.stream) {
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                }
                
                // Reset UI
                document.getElementById('start-recording').classList.remove('recording');
                document.getElementById('start-recording').innerHTML = '<i class="fas fa-microphone"></i><span>Start Recording</span>';
                document.getElementById('start-recording').disabled = false;
                document.getElementById('pause-recording').disabled = true;
                document.getElementById('stop-recording').disabled = true;
                document.getElementById('pause-recording').innerHTML = '<i class="fas fa-pause"></i>';
                document.getElementById('recorder-time').textContent = '00:00';
            }
            
            function updateRecordingTime() {
                if (!isPaused) {
                    const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const seconds = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('recorder-time').textContent = `${minutes}:${seconds}`;
                }
            }
            
            function setupVisualizer() {
                const canvas = document.getElementById('audio-visualizer');
                const canvasCtx = canvas.getContext('2d');
                const WIDTH = canvas.width;
                const HEIGHT = canvas.height;
                
                analyser.fftSize = 256;
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                function draw() {
                    requestAnimationFrame(draw);
                    
                    analyser.getByteFrequencyData(dataArray);
                    
                    canvasCtx.fillStyle = 'rgb(200, 200, 200)';
                    canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
                    
                    const barWidth = (WIDTH / bufferLength) * 2.5;
                    let barHeight;
                    let x = 0;
                    
                    for (let i = 0; i < bufferLength; i++) {
                        barHeight = dataArray[i] / 2;
                        
                        canvasCtx.fillStyle = `rgb(108, 99, 255)`;
                        canvasCtx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);
                        
                        x += barWidth + 1;
                    }
                }
                
                draw();
            }
            
            function handleAudioUpload(event) {
                // Check if user has consented
                if (localStorage.getItem('solidarityCastConsent') !== 'accepted') {
                    alert('Please accept the consent agreement before uploading.');
                    consentModal.style.display = 'flex';
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                // Validate file type
                if (!file.type.startsWith('audio/')) {
                    alert('Please select an audio file.');
                    return;
                }
                
                // Show upload progress
                const progress = document.getElementById('upload-progress');
                const progressFill = document.getElementById('upload-progress-fill');
                const progressPercent = document.getElementById('upload-percentage');
                
                progress.style.display = 'flex';
                
                // Simulate upload progress (in a real app, this would be actual upload progress)
                let percent = 0;
                const interval = setInterval(() => {
                    percent += 5;
                    progressFill.style.width = `${percent}%`;
                    progressPercent.textContent = `${percent}%`;
                    
                    if (percent >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            progress.style.display = 'none';
                            reviewRecording(file);
                        }, 500);
                    }
                }, 100);
            }
            
            function reviewRecording(audioBlob) {
                // Show modal
                document.getElementById('review-modal').style.display = 'flex';
                
                // Set up audio player
                const audioPlayer = document.getElementById('audio-player');
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayer.src = audioUrl;
                
                // Set up play button
                document.getElementById('modal-play-btn').addEventListener('click', function() {
                    if (audioPlayer.paused) {
                        audioPlayer.play();
                        this.innerHTML = '<i class="fas fa-pause"></i>';
                    } else {
                        audioPlayer.pause();
                        this.innerHTML = '<i class="fas fa-play"></i>';
                    }
                });
                
                // Update time display
                audioPlayer.addEventListener('timeupdate', function() {
                    const currentTime = formatTime(audioPlayer.currentTime);
                    const duration = formatTime(audioPlayer.duration);
                    document.getElementById('modal-time-display').textContent = `${currentTime} / ${duration}`;
                    document.getElementById('modal-progress-bar').value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                });
                
                // Seek functionality
                document.getElementById('modal-progress-bar').addEventListener('input', function() {
                    const seekTime = (this.value / 100) * audioPlayer.duration;
                    audioPlayer.currentTime = seekTime;
                });
                
                // Reset when audio ends
                audioPlayer.addEventListener('ended', function() {
                    document.getElementById('modal-play-btn').innerHTML = '<i class="fas fa-play"></i>';
                });
                
                // Simulate AI analysis
                setTimeout(() => {
                    document.getElementById('ai-feedback-result').className = 'feedback-result positive';
                    document.getElementById('ai-feedback-result').innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <p>This recording appears emotionally safe to share. No harmful content detected.</p>
                    `;
                    
                    document.getElementById('ai-feedback-note').innerHTML = `
                        <p><strong>Note:</strong> The AI detected moments where you sounded emotional. This is completely normal when sharing personal experiences. Would you like to edit those sections?</p>
                    `;
                }, 3000);
            }
            
            function formatTime(seconds) {
                if (isNaN(seconds)) return '00:00';
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // Close modal when clicking outside or on close button
            document.getElementById('modal-close').addEventListener('click', function() {
                document.getElementById('review-modal').style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('review-modal')) {
                    document.getElementById('review-modal').style.display = 'none';
                }
            });
            
            // Modal action buttons
            document.getElementById('save-draft').addEventListener('click', function() {
                alert('Recording saved as draft.');
                document.getElementById('review-modal').style.display = 'none';
            });
            
            document.getElementById('delete-recording').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete this recording?')) {
                    alert('Recording deleted.');
                    document.getElementById('review-modal').style.display = 'none';
                }
            });
            
            document.getElementById('publish-recording').addEventListener('click', function() {
                alert('Recording published to SolidarityCast!');
                document.getElementById('review-modal').style.display = 'none';
            });
            
            // Help button
            document.getElementById('cast-help').addEventListener('click', function() {
                addAIMessage("How can I help you? You can ask me about: recording process, emotional safety, privacy, or resources.", true);
                document.getElementById('ai-chat-container').scrollTop = document.getElementById('ai-chat-container').scrollHeight;
            });
            
            // Journal Editor Toggle
            const newEntryBtn = document.getElementById('new-entry');
            const journalEditor = document.getElementById('journal-editor');
            const cancelEntryBtn = document.getElementById('cancel-entry');
            const journalList = document.getElementById('journal-list');
            
            newEntryBtn.addEventListener('click', function() {
                journalEditor.style.display = 'block';
                journalList.style.display = 'none';
                newEntryBtn.style.display = 'none';
                document.getElementById('journal-content').focus();
            });
            
            cancelEntryBtn.addEventListener('click', function() {
                journalEditor.style.display = 'none';
                journalList.style.display = 'grid';
                newEntryBtn.style.display = 'flex';
            });

            // Mood Selection for Journal
            const moodBtns = document.querySelectorAll('.mood-btn');
            moodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    moodBtns.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Simple Sentiment Analysis for Journal
            const journalContent = document.getElementById('journal-content');
            const sentimentAnalysis = document.getElementById('sentiment-analysis');
            
            journalContent.addEventListener('input', function() {
                const text = this.value.toLowerCase();
                let sentiment = 'neutral';
                let sentimentText = 'neutral reflection';
                
                if (text.includes('happy') || text.includes('good') || text.includes('progress')) {
                    sentiment = 'positive';
                    sentimentText = 'hope and progress';
                } else if (text.includes('sad') || text.includes('hard') || text.includes('difficult')) {
                    sentiment = 'negative';
                    sentimentText = 'challenge or difficulty';
                } else if (text.includes('angry') || text.includes('mad') || text.includes('frustrat')) {
                    sentiment = 'angry';
                    sentimentText = 'anger or frustration';
                }
                
                document.getElementById('sentiment-result').textContent = sentimentText;
                sentimentAnalysis.style.display = 'block';
            });

            // Save Journal Entry (simplified for demo)
            document.getElementById('save-entry').addEventListener('click', function() {
                const entryText = journalContent.value;
                const selectedMood = document.querySelector('.mood-btn.selected')?.dataset.mood || 'neutral';
                
                if (entryText.trim() === '') {
                    alert('Please write something before saving');
                    return;
                }
                
                // In a real app, this would save to a database
                console.log('Saved entry:', {text: entryText, mood: selectedMood});
                
                // Reset and show list
                journalContent.value = '';
                moodBtns.forEach(b => b.classList.remove('selected'));
                journalEditor.style.display = 'none';
                journalList.style.display = 'grid';
                newEntryBtn.style.display = 'flex';
                
                // Add to the top of the list (simplified)
                const entryDate = new Date().toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const moodEmoji = {
                    peaceful: 'ðŸ˜Œ',
                    hopeful: 'ðŸ˜Š',
                    neutral: 'ðŸ˜',
                    anxious: 'ðŸ˜Ÿ',
                    overwhelmed: 'ðŸ˜£'
                }[selectedMood];
                
                const newEntry = document.createElement('div');
                newEntry.className = 'journal-card';
                newEntry.innerHTML = `
                    <div class="journal-meta">
                        <span class="journal-date">${entryDate}</span>
                        <span class="journal-mood mood-${selectedMood}">${moodEmoji} ${selectedMood.charAt(0).toUpperCase() + selectedMood.slice(1)}</span>
                    </div>
                    <h3>New Entry</h3>
                    <div class="journal-content">
                        <p>${entryText.substring(0, 100)}${entryText.length > 100 ? '...' : ''}</p>
                    </div>
                    <div class="journal-tags">
                        <span class="journal-tag">new</span>
                    </div>
                    <button class="btn-small" style="margin-top: 15px;">Read More</button>
                `;
                
                journalList.prepend(newEntry);
            });
        });
    </script>
</body>
</html>